<!DOCTYPE html>
<html>
  <head>
  <style>
  #gameboard {
    border: thick solid #84d8ab;
}
  #snackbar2 {
    visibility: hidden;
    min-width: 100%;
    min-height: 50%;
    margin-left: -11.75%;
    background-color: #000;
    color: white;
    text-align: center;
    border-radius: 10px;
    padding: 16px;
    position: fixed;
    z-index: 4;
    left: 10%;
    bottom: 35%;
    font-size: 35px;
    opacity : 0.75;
}
	#snackbar {
		text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
		visibility: hidden;
		min-width: 250px;
		margin-left: -125px;
		--background-color: #fff;
		color: #ef9692;
		text-align: center;
		border-radius: 20px;
		padding: 16px;
		position: fixed;
		z-index: 1;
		left: 48%;
		bottom: 70%;
		font-size: 120px;
    opacity : 0.80;
	}
	#snackbar.show {
		visibility: visible;
		-webkit-animation: fadein 1s, fadeout 1s 2.5s;
		animation: fadein 1s, fadeout 1s 2.5s;
	}
  #snackbar2.show {
      visibility: visible;
      -webkit-animation: fadein2 1s, fadeout 0.5s 2.5s;
      animation: fadein2 1s, fadeout 0.5s 2.5s;
  }

	@-webkit-keyframes fadein {
		from {bottom: 0; opacity: 0;}
		to {bottom: 70%; opacity: 0.80;}
	}

	@keyframes fadein {
		from {bottom: 0; opacity: 0;}
		to {bottom: 70%; opacity: 0.80;}
	}
  @-webkit-keyframes fadein2 {
    from {bottom: 0; opacity: 0;}
    to {bottom: 35%; opacity: 0.75;}
  }

  @keyframes fadein2 {
    from {bottom: 0; opacity: 0;}
    to {bottom: 35%; opacity: 0.75;}
	
  }
	</style>
    <meta charset="utf-8">
    <meta content='width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=0' name='viewport' />
    <title>Tic Tac toe</title>
    <!--style media="screen">
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        display: table;

      }

    </style-->
    <script type="text/javascript">
	function addDelay(id) {
    document.getElementById(id).style.WebkitTransition = "all 0.20s"; // Code for Safari 3.1 to 6.0
    document.getElementById(id).style.transition = "all 0.20s";       // Standard syntax
	}
	function animateBox(id,len){
	document.getElementById(id).style.width=len;
	document.getElementById(id).style.height=len;
	//document.getElementById(id).style.padding="0px";
	}
	function changeColor(colorTable,colorScore) {
    document.getElementById("gameboard").style.borderColor = colorTable;
	document.getElementById("snackbar").style.color = colorScore;
}
    function myFunctionWon() {
    var x = document.getElementById("snackbar2")
    x.className = "show";
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 100000);
}
	function myFunction() {
    var x = document.getElementById("snackbar")
    x.className = "show";
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 1200);
}
      function getvalue(vardata){
        var getdata = window.location.search;
        var param_array = getdata.replace('?', '').split('&');
        for(var i= 0; i < param_array.length ; i++){
          var x = param_array[i].split('=');
          if(x[0] == vardata){
            return x[1];
          }
        }
        return 0;

      };

      function inatializePage(){
        // window.location.reload()
        var boxlength = getvalue('boxlength');
        var boxheight = getvalue('boxheight');
        var player = getvalue('player');
        if(isNaN(boxlength) || isNaN(boxheight) || isNaN(player)){
          //alert("Not a valid data");
          window.location = "index.html";
        }else{
          if(boxlength > 8 || boxlength < 4 || boxheight > 8 || boxheight < 4 || player > 3 || player < 2){
            //alert("Not a valid data");
            window.location = "index.html";
          }else{
            doAfterinitialization(boxlength, boxheight, player);
            //alert("initialized ok");
          }
        }
      };

      function doAfterinitialization(boxlength, boxheight, player){
        initailiseScoreboard(player);
        initailiseGameboard(boxlength, boxheight);
      };

      function initailiseScoreboard(player){
        var table = document.getElementById("scoreboard");
        var player_array = [];
        var row = table.insertRow(0);
        for(var i = 0; i < player*2; i+=2){
          var playername = row.insertCell(i);
          playername.innerHTML = "Player-" + (i/2 + 1);
          player_array[i] = row.insertCell(i+1);
          player_array[i].innerHTML = "0";
        }
      };

      function initailiseGameboard(boxlength, boxheight){
        var table = document.getElementById("gameboard");
        //table.setAttribute("style", " align:center; padding:0; margin:0; width:"+ (boxlength*100) +"px; height:"+ (boxheight*100) +"px;");
        for(var i = 0; i < boxheight; i++){
          var row = table.insertRow(i);
          for(var j = 0; j < boxlength; j++){
            var celldata = row.insertCell(j);
            pos1 = '' + i + j;
            celldata.setAttribute("id", pos1);
            celldata.setAttribute("title", "-1");
			var w = window.innerWidth-50;
			var h = window.innerHeight-150;
			var len = 0;
			if(w>h){
				len=h/boxheight;
			}
			else{
				len=w/boxlength;
			}
            celldata.innerHTML = '<input type="button" style="padding:0; margin:0; width:'+len+'px; height:'+len+'px;border: none;cursor: pointer; background-color:black;" name="-1" onclick="Changeandcalc(title)" title="'+ i + j +'" value="">';
		  }
        }
      };

    function Changeandcalc(pos){

      var player = countplayer();
      changeValue(pos, player);
      var board = generateboard();
      var score = calulateScore(board, parseInt(player));
      updatescore(score);
    };

    function updatescore(score){
      var drawplayer = [];
      var table = document.getElementById("scoreboard");
      var row = table.rows[0];
      var j = 0;
      var isTie = false;
      var isboardfull = document.getElementById("winner");
      var winner = -1;
      var winnerindex = -1;
      for(var i = 1; i < row.cells.length ; i+=2){
        if(isboardfull.innerHTML.trim() != '' && winner < score[j]){
          winnerindex = j;
          winner = score[j];
        }
        if(row.cells[i].innerHTML != score[j]){
          var data1 = document.getElementById("snackbar");
          data1.innerHTML = '+' + (score[j] - row.cells[i].innerHTML);
          myFunction();
        }
        row.cells[i].innerHTML = score[j];
        j++;
      }
      for(var i = 0; i < score.length ; i++){
        drawplayer[i] = 0;
        if(winner == score[i] && winnerindex != i){
          isTie = true;
        }
        if(winner == score[i]){
          drawplayer[i]++;
        }
      }
      if(isboardfull.innerHTML.trim() != ''){
        if(isTie){
          isboardfull.innerHTML = 'Draw between ';
          for(var i = 0; i < drawplayer.length; i++){
            if(drawplayer[i] == 1){
              isboardfull.innerHTML = isboardfull.innerHTML + row.cells[(i + 1) * 2 -2].innerHTML + ' &amp; ';
            }
          }
          isboardfull.innerHTML = isboardfull.innerHTML.substring(0, isboardfull.innerHTML.length - 6);
        }else{	
          isboardfull.innerHTML = row.cells[(winnerindex + 1) * 2 -2].innerHTML + ' Won!!!';
        }
        var winnertab = document.getElementById("snackbar2");
        winnertab.innerHTML = isboardfull.innerHTML;
        myFunctionWon();
      }
    };


    function generateboard(){
      var table = document.getElementById("gameboard");
      var board = [];
      for(var i = 0; i < table.rows.length; i++){
        var rowdata = [];
        var row = table.rows[i];
        for(var j = 0; j< row.cells.length; j++){
          rowdata[j] = parseInt(row.cells[j].getAttribute("title"));
        }
        board[i] = rowdata;
      }
      return board;
    }


    function changeValue(pos, totalplayer){
    var cell = document.getElementById(pos);
    var para = document.getElementById("player");
    var player = para.innerHTML;
    cell.setAttribute("title", player);
	var boxlength = getvalue('boxlength');
    var boxheight = getvalue('boxheight');
	var w = window.innerWidth-50;
	var h = window.innerHeight-150;
	var len = 0;
	if(w>h){
		len=h/boxheight;
	}
	else{
		len=w/boxlength;
	}
    cell.innerHTML = '<img src="img/'+player+'.PNG" id=id'+pos+' align="middle" height="0px" width="0px" style="display: block;padding:0; margin:0;margin-left:auto;margin-right:auto;border-radius: 50%;"/>';
	addDelay('id'+pos);
	setTimeout(function() {
		animateBox('id'+pos,len+'px');
}, 1);
	window.navigator.vibrate(50);
	if(player==0){
		changeColor("#ea8579","#84d8ab");
	}
	else if(player==1 && totalplayer==2){
		changeColor("#84d8ab","#ea8579");
	}
	else if(player==1 && totalplayer==3){
		changeColor("#f2f098","#ea8579");
	}
	else if(player==2){
		changeColor("#84d8ab","#f2f098");
	}
    player  = parseInt(player) + 1;
    if(parseInt(player) >= parseInt(totalplayer)){
      player = 0;
    }
    para.innerHTML = player;
    };

    function countplayer(){
      var table = document.getElementById("scoreboard");
      var player = table.rows[0].cells.length / 2;
      return player;
    };



    function calulateScore(boardPoints, player) {

    var hBoard = boardPoints.length;
    var bBoard = boardPoints[0].length;
    var score = [0, 0, 0];
    var count = 0;
    for (var i = 0; i < hBoard; i++) {
      for (var j = 0; j < bBoard; j++) {
        if(boardPoints[i][j] != -1 && boardPoints[i][j] < player){
          count++;
          if (j <= bBoard - 3) {
            if (boardPoints[i][j] == boardPoints[i][j + 1]
                && boardPoints[i][j] == boardPoints[i][j + 2]) {
              score[boardPoints[i][j]]++;
            }
          }
          if (i <= (hBoard - 3) && j <= (bBoard - 3)) {
            if (boardPoints[i][j] == boardPoints[i + 1][j + 1]
                && boardPoints[i][j] == boardPoints[i + 2][j + 2]) {
              score[boardPoints[i][j]]++;
            }
          }
          if (i + 2 < hBoard) {
            if (boardPoints[i][j] == boardPoints[i + 1][j]
                && boardPoints[i][j] == boardPoints[i + 2][j]) {
              score[boardPoints[i][j]]++;
            }
          }
          if ((i + 2) < hBoard && (j - 2) >= 0) {
            if (boardPoints[i][j] == boardPoints[i + 1][j - 1]
                && boardPoints[i][j] == boardPoints[i + 2][j - 2]) {
              score[boardPoints[i][j]]++;
            }
          }
        }
      }
    }
    if(count == (hBoard * bBoard)){
      var winner = document.getElementById("winner");
      winner.innerHTML =  'uuu';
    }
    return score;
  };

    </script>
  </head>
  <body onload="inatializePage()">
    <p hidden="true" id="player">0</p>
    <p hidden="true" id="winner"></p>
    <table id="scoreboard" border="1" align="center" height=50px style='font-size : 30px'>

    </table>
    <table id="gameboard" border="1" bordercolor="black" align="center" bgcolor="black">

    </table>
	<input type="button" value="Reset" onClick="window.location.reload()" style='color:white;width:100%;height:100px;background-color:black;'>

<div id="snackbar">+1</div>
<br><br><br><br><br><br>
<div id="snackbar2"><br><br>Player 1 Won</div>
  </body>
</html>
